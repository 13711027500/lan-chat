# LAN Chat - 局域网聊天应用

一个基于WebSocket的实时聊天应用，支持文本消息、文件传输、私聊等功能。

## 功能特性

- 💬 实时聊天
- 👥 用户在线状态
- 📁 文件传输
- 🔒 私聊功能
- 😊 表情支持
- 🎨 自定义主题
- 📱 响应式设计
- 💾 消息本地存储

## 部署方式

### 1. GitHub Pages 部署（推荐）

GitHub Pages 只支持静态文件，因此应用会自动切换到**本地聊天模式**：

- ✅ 支持发送和接收消息
- ✅ 本地消息存储
- ✅ 模拟其他用户回复
- ❌ 不支持实时多人聊天
- ❌ 不支持文件传输
- ❌ 不支持私聊功能

**部署步骤：**
1. 将代码推送到GitHub仓库
2. 在仓库设置中启用GitHub Pages
3. 选择分支和目录（通常是 `/docs` 或 `/`）
4. 访问生成的网址即可使用

### 2. 完整服务器部署

如需完整功能，需要部署到支持Node.js的服务器：

```bash
# 安装依赖
npm install

# 启动服务器
npm start

# 或使用PM2生产环境部署
npm run prod
```

## 本地开发

```bash
# 克隆仓库
git clone https://github.com/your-username/lan-chat.git
cd lan-chat

# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

访问 `http://localhost:3000` 开始使用。

## 技术栈

- **前端**: HTML5, CSS3, JavaScript (ES6+)
- **后端**: Node.js, Express.js
- **实时通信**: WebSocket (ws)
- **认证**: JWT
- **密码加密**: bcrypt
- **部署**: GitHub Pages, PM2

## 项目结构

```
lan-chat/
├── public/              # 静态文件
│   ├── index.html      # 主页面
│   ├── login.html      # 登录页面
│   ├── script.js       # 前端逻辑
│   └── style.css       # 样式文件
├── server.js           # 服务器代码
├── users.json          # 用户数据
├── package.json        # 项目配置
└── README.md          # 项目说明
```

## 环境变量

| 变量名 | 默认值 | 说明 |
|--------|--------|------|
| PORT | 3000 | 服务器端口 |
| HOST | 0.0.0.0 | 监听地址 |
| NODE_ENV | development | 运行环境 |

## 浏览器兼容性

- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+

## 许可证

ISC License

## 贡献

欢迎提交Issue和Pull Request！

## 更新日志

### v1.1.0
- 添加GitHub Pages支持
- 实现本地聊天模式
- 优化错误处理
- 改进用户体验

### v1.0.0
- 初始版本发布
- 基础聊天功能
- 文件传输
- 私聊功能

# 局域网聊天应用 - 撤回功能说明

## 新增功能：消息撤回

### 功能特点

1. **右键菜单**: 右键点击自己发送的消息会显示上下文菜单
2. **撤回选项**: 在2分钟内的消息可以撤回
3. **复制功能**: 可以复制消息内容或文件名到剪贴板
4. **实时同步**: 撤回操作会实时同步给所有在线用户
5. **支持文件**: 文本消息和文件消息都支持撤回功能

### 使用方法

1. **发送消息**: 正常发送文本消息或文件
2. **撤回消息**: 
   - 右键点击自己发送的消息或文件
   - 在弹出的菜单中选择"撤回消息"
   - 消息会显示为"消息已撤回"或"文件已撤回"状态

3. **复制功能**:
   - 右键点击消息
   - 选择"复制消息"（文本消息）或"复制文件名"（文件消息）
   - 内容会复制到剪贴板

### 技术实现

#### 前端实现
- 为每条消息添加唯一ID (`data-message-id`)
- 右键事件监听器 (`contextmenu`)
- 动态创建上下文菜单
- WebSocket发送撤回请求
- 区分文本消息和文件消息的处理

#### 后端实现
- 处理 `recall_message` 类型的WebSocket消息
- 验证用户身份（只能撤回自己的消息）
- 广播撤回消息给所有在线用户

#### 样式设计
- 现代化的右键菜单样式
- 撤回消息的视觉反馈（透明度降低，斜体显示）
- 响应式设计，适配各种屏幕尺寸

### 限制条件

- 只能撤回自己发送的消息
- 只能撤回2分钟内的消息
- 系统消息不支持撤回
- 支持文本消息和文件消息的撤回

### 文件修改

1. `public/script.js` - 添加撤回功能逻辑，支持文件消息
2. `public/style.css` - 添加右键菜单样式
3. `server.js` - 添加撤回消息处理

### 测试

1. 发送文本消息，右键点击测试撤回功能
2. 发送文件（图片或文档），右键点击测试撤回功能
3. 验证撤回操作在所有用户端都能看到

### 启动应用

```bash
npm install
npm start
```

访问 `http://localhost:3000` 开始使用聊天应用。 